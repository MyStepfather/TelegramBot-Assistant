# TelegramBotAssistant
Это рабочий чат-бот с возможностью использовать заскриптованные команды, а так же вести беседу и помогать в решении самых разных задачах, задействуя chatGPT.


## Содержание
- [Технологии](#технологии)
- [Начало работы](#начало-работы)
- [Тестирование](#тестирование)
- [Deploy и CI/CD](#deploy-и-ci/cd)
- [Contributing](#contributing)
- [To do](#to-do)
- [Команда проекта](#команда-проекта)

## Технологии
- [Python](https://www.python.org/)
- [Telebot](https://pypi.org/project/telebot/)
- [OpenAI](https://openai.com/)

## Использование

Обязательно прочтите перед использованием, так как проект делал для себя, и в некоторых моментах 
данные придется вносить руками.

### Установка пакетов
Установите необходимые пакеты в requirements.txt:
```sh
pip install -r requirements.txt
```

### Создание таблицы "памяти" в SQL 
Запустите этот код, чтобы создать таблицу в SQL с данными о вашем боте:
```python
from tools.sqlChatModel import SqlChatModel
sql_chat_bot = SqlChatModel(input("Введите имя бота: "))
sql_chat_bot.create_table(sql_chat_bot.nameBot)
print(f"{sql_chat_bot.nameBot} успешно добавлен!")
```

### Подготовка к настройкам
Затем перейдите в папку data откройте private. Заполните поля USER_1, если надо, USER_2 (Если не знаете свой id - запустите своего бота
, введя токен бота, и нажмите /start - в логах увидите свой id), TELEGRAM_TOKEN, CHAT_GPT_TOKEN. Может быть сколько угодно пользователей, но права каждого надо настраивать,
 пока что, в ручную.

- Чтобы получить TELEGRAM_TOKEN создайте телеграм-бота через BotFather.

- Чтобы получить CHAT_GPT_TOKEN, просто зарегистрируйтесь на OpenAI и перейдите в раздел своего профиля, затем выберите API.

По желанию измените имена в NAMES.


### Концепция памяти ChatGPT
Программа настроена так, что для каждого идёт отдельный бот со своей памятью и историей сообщений, однако
 можно использовать и одного бота. Чтобы настроить, кто какого бота будет использовать, перейдите в data, 
commands_settings.py, и в COMMANDS_SETTING["chatGPT"]["bot_name_for_current_user"] и вставьте имя бота, 
которого вы добавляли через код выше в SQL.

Также, в BotFather настройте бота и добавьте ему команду /edit_bot, чтобы удобно запускать команду через меню. 
Эта команда позволяет редактировать постоянную память бота. Бот может "держать" в голове некоторые 
заведомо сгенерированные вами вопросы и ответы, чтобы иметь личностные свойства (имя, отношение к вам,
 или же вы захотите, чтобы бот всегда помнил какие-то факты). Память бота не может содержать свыше 4097 токенов 
(примерно, 3 символа = 1 токен, если на латинице, иначе 1 к 1), причем ответ от бота тоже занимает память 
, так что слишком много диалогов не добавить. Также, существует "оперативная память" бота. Бот помнит три последних 
сообщения + основная память, так что вполне может логично продолжать беседу. 

В будущем я планирую написать дополнительное решение "динамической памяти", чтобы освобождать максимально токены 
для технических задач, к примеру, по написанию длинного кода, или же увеличивать оперативную память при беседе, 
чтобы бот помнил до 15 вопрос-ответов.

### Команды \ Скрипты

Есть возможность добавлять новые команды (типа makeCharacterBot, и не только). Самое главное - все команды
 принимают и аргументы:
- message - это поступающие от бота данные 
- bot - экземпляр бота, с которого посылаем сообщения,
- actually_status - состояние пользователя, а именно в какой команде сейчас находится, и в каком сценарии
- settings - настройки commands_setting в оперативной памяти бота
- debug - делает логи в консоли, по-умолчанию True 

Возвращать команда всегда должна actually_status и settings. Смотрите пример makeCharacterBot.

Команды бота работают на сценариях. К примеру, если вы активировали /edit_bot, то команда возвращает 
сценарий "choice". Если в actually_status есть активная программа, то она автоматически активируется и 
действует согласно сценарию.



## Автор

- [Илья Соловьев](https://github.com/exerussus) — backend-developer
